var bt=Object.defineProperty,wt=Object.defineProperties;var $t=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var St=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var xe=(e,n,t)=>n in e?bt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,N=(e,n)=>{for(var t in n||(n={}))St.call(n,t)&&xe(e,t,n[t]);if(Fe)for(var t of Fe(n))Ct.call(n,t)&&xe(e,t,n[t]);return e},Y=(e,n)=>wt(e,$t(n));var Be=(e,n,t)=>new Promise((s,o)=>{var i=r=>{try{a(t.next(r))}catch(f){o(f)}},l=r=>{try{a(t.throw(r))}catch(f){o(f)}},a=r=>r.done?s(r.value):Promise.resolve(r.value).then(i,l);a((t=t.apply(e,n)).next())});import{d as E,r as T,i as ce,a as ge,w as kt,c as D,b as Ft,u as xt,p as K,e as Bt,f as Et,m as Tt,g as me,v as Ee,h as S,F as Dt,T as Ue,j as He,N as ye,k as y,l as ue,n as M,o as U,q as Ot,s as At,t as Ve,x as Mt,y as G,z as Pt,A as Te,B as Ye,C as zt,L as It,D as X,E as Rt,G as Lt,H as jt,I as Nt,J as Ut,K as Ht,M as Vt,O as Yt,P as Kt,Q as q,R as he,S as Xt,U as qt,V as Wt,W as Jt,X as Zt,Y as Ke,_ as Xe,Z as De,$ as Q,a0 as Gt,a1 as fe,a2 as Qt,a3 as v,a4 as en,a5 as V,a6 as de,a7 as qe,a8 as We,a9 as m,aa as O,ab as h,ac as g,ad as tn,ae as I,af as nn,ag as se,ah as oe,ai as sn,aj as Je,ak as w,al as b,am as B,an as Ze,ao as z,ap as A,aq as Oe,ar as W,as as on,at as rn,au as an,av as Ge,aw as J,ax as ie,ay as Ae,az as ln,aA as cn,aB as Qe,aC as un,aD as dn}from"./plugin-vue_export-helper.1684445f.js";import{c as fn,a as le,b as pn,d as mn,N as hn,l as _n}from"./lodash.c099196f.js";var vn=E({name:"NDrawerContent",inheritAttrs:!1,props:{blockScroll:Boolean,show:{type:Boolean,default:void 0},displayDirective:{type:String,required:!0},placement:{type:String,required:!0},contentStyle:[Object,String],nativeScrollbar:{type:Boolean,required:!0},scrollbarProps:Object,trapFocus:{type:Boolean,default:!0},autoFocus:{type:Boolean,default:!0},showMask:{type:Boolean,required:!0},onClickoutside:Function,onAfterLeave:Function,onAfterEnter:Function,onEsc:Function},setup(e){const n=T(!!e.show),t=T(null),s=ce(ge);kt(()=>{e.show&&(n.value=!0)});const o=D(()=>{const{show:l}=e,a=[[Ee,l]];return e.showMask||a.push([Ft,e.onClickoutside,void 0,{capture:!0}]),a});function i(){var l;n.value=!1,(l=e.onAfterLeave)===null||l===void 0||l.call(e)}return xt(D(()=>e.blockScroll&&n.value)),K(Bt,t),K(Et,null),K(Tt,null),{bodyRef:t,mergedClsPrefix:s.mergedClsPrefixRef,isMounted:s.isMountedRef,mergedTheme:s.mergedThemeRef,displayed:n,transitionName:D(()=>({right:"slide-in-from-right-transition",left:"slide-in-from-left-transition",top:"slide-in-from-top-transition",bottom:"slide-in-from-bottom-transition"})[e.placement]),handleAfterLeave:i,bodyDirectives:o}},render(){const{$slots:e,mergedClsPrefix:n}=this;return this.displayDirective==="show"||this.displayed||this.show?me(S("div",{role:"none"},S(Dt,{disabled:!this.showMask||!this.trapFocus,active:this.show,autoFocus:this.autoFocus,onEsc:this.onEsc},{default:()=>S(Ue,{name:this.transitionName,appear:this.isMounted,onAfterEnter:this.onAfterEnter,onAfterLeave:this.handleAfterLeave},{default:()=>me(S("div",He(this.$attrs,{role:"dialog",ref:"bodyRef","aria-modal":"true",class:[`${n}-drawer`,`${n}-drawer--${this.placement}-placement`,this.nativeScrollbar&&`${n}-drawer--native-scrollbar`]}),[this.nativeScrollbar?S("div",{class:`${n}-drawer-content-wrapper`,style:this.contentStyle,role:"none"},e):S(ye,Object.assign({},this.scrollbarProps,{contentStyle:this.contentStyle,contentClass:`${n}-drawer-content-wrapper`,theme:this.mergedTheme.peers.Scrollbar,themeOverrides:this.mergedTheme.peerOverrides.Scrollbar}),e)]),this.bodyDirectives)})})),[[Ee,this.displayDirective==="if"||this.displayed||this.show]]):null}});const{cubicBezierEaseIn:gn,cubicBezierEaseOut:yn}=ue;function bn({duration:e="0.3s",leaveDuration:n="0.2s",name:t="slide-in-from-right"}={}){return[y(`&.${t}-transition-leave-active`,{transition:`transform ${n} ${gn}`}),y(`&.${t}-transition-enter-active`,{transition:`transform ${e} ${yn}`}),y(`&.${t}-transition-enter-to`,{transform:"translateX(0)"}),y(`&.${t}-transition-enter-from`,{transform:"translateX(100%)"}),y(`&.${t}-transition-leave-from`,{transform:"translateX(0)"}),y(`&.${t}-transition-leave-to`,{transform:"translateX(100%)"})]}const{cubicBezierEaseIn:wn,cubicBezierEaseOut:$n}=ue;function Sn({duration:e="0.3s",leaveDuration:n="0.2s",name:t="slide-in-from-left"}={}){return[y(`&.${t}-transition-leave-active`,{transition:`transform ${n} ${wn}`}),y(`&.${t}-transition-enter-active`,{transition:`transform ${e} ${$n}`}),y(`&.${t}-transition-enter-to`,{transform:"translateX(0)"}),y(`&.${t}-transition-enter-from`,{transform:"translateX(-100%)"}),y(`&.${t}-transition-leave-from`,{transform:"translateX(0)"}),y(`&.${t}-transition-leave-to`,{transform:"translateX(-100%)"})]}const{cubicBezierEaseIn:Cn,cubicBezierEaseOut:kn}=ue;function Fn({duration:e="0.3s",leaveDuration:n="0.2s",name:t="slide-in-from-top"}={}){return[y(`&.${t}-transition-leave-active`,{transition:`transform ${n} ${Cn}`}),y(`&.${t}-transition-enter-active`,{transition:`transform ${e} ${kn}`}),y(`&.${t}-transition-enter-to`,{transform:"translateY(0)"}),y(`&.${t}-transition-enter-from`,{transform:"translateY(-100%)"}),y(`&.${t}-transition-leave-from`,{transform:"translateY(0)"}),y(`&.${t}-transition-leave-to`,{transform:"translateY(-100%)"})]}const{cubicBezierEaseIn:xn,cubicBezierEaseOut:Bn}=ue;function En({duration:e="0.3s",leaveDuration:n="0.2s",name:t="slide-in-from-bottom"}={}){return[y(`&.${t}-transition-leave-active`,{transition:`transform ${n} ${xn}`}),y(`&.${t}-transition-enter-active`,{transition:`transform ${e} ${Bn}`}),y(`&.${t}-transition-enter-to`,{transform:"translateY(0)"}),y(`&.${t}-transition-enter-from`,{transform:"translateY(100%)"}),y(`&.${t}-transition-leave-from`,{transform:"translateY(0)"}),y(`&.${t}-transition-leave-to`,{transform:"translateY(100%)"})]}var Tn=y([M("drawer",`
 line-height: var(--n-line-height);
 position: absolute;
 pointer-events: all;
 box-shadow: var(--n-box-shadow);
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 background-color: var(--n-color);
 color: var(--n-text-color);
 box-sizing: border-box;
 `,[bn(),Sn(),Fn(),En(),U("native-scrollbar",[M("drawer-content-wrapper",`
 overflow: auto;
 height: 100%;
 `)]),M("drawer-content-wrapper",`
 box-sizing: border-box;
 `),M("drawer-content",`
 height: 100%;
 display: flex;
 flex-direction: column;
 `,[U("native-scrollbar",[M("drawer-body-content-wrapper",`
 height: 100%;
 overflow: auto;
 `)]),M("drawer-body",`
 flex: 1 0 0;
 overflow: hidden;
 `),M("drawer-body-content-wrapper",`
 box-sizing: border-box;
 padding: var(--n-body-padding);
 `),M("drawer-header",`
 font-weight: var(--n-title-font-weight);
 line-height: 1;
 font-size: var(--n-title-font-size);
 color: var(--n-title-text-color);
 padding: var(--n-header-padding);
 transition: border .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-divider-color);
 border-bottom: var(--n-header-border-bottom);
 display: flex;
 justify-content: space-between;
 align-items: center;
 `,[Ot("close",`
 transition: color .3s var(--n-bezier);
 font-size: var(--n-close-size);
 `)]),M("drawer-footer",`
 display: flex;
 justify-content: flex-end;
 border-top: var(--n-footer-border-top);
 transition: border .3s var(--n-bezier);
 padding: var(--n-footer-padding);
 `)]),U("right-placement",`
 top: 0;
 bottom: 0;
 right: 0;
 `),U("left-placement",`
 top: 0;
 bottom: 0;
 left: 0;
 `),U("top-placement",`
 top: 0;
 left: 0;
 right: 0;
 `),U("bottom-placement",`
 left: 0;
 bottom: 0;
 right: 0;
 `)]),y("body",[y(">",[M("drawer-container",{position:"fixed"})])]),M("drawer-container",`
 position: relative;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 pointer-events: none;
 `,[y("> *",{pointerEvents:"all"})]),M("drawer-mask",`
 background-color: rgba(0, 0, 0, .3);
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 `,[U("invisible",`
 background-color: rgba(0, 0, 0, 0)
 `),At({enterDuration:"0.2s",leaveDuration:"0.2s",enterCubicBezier:"var(--n-bezier-in)",leaveCubicBezier:"var(--n-bezier-out)"})])]);const Dn=Object.assign(Object.assign({},G.props),{show:Boolean,width:{type:[Number,String],default:251},height:{type:[Number,String],default:251},placement:{type:String,default:"right"},maskClosable:{type:Boolean,default:!0},showMask:{type:Boolean,default:!0},to:[String,Object],displayDirective:{type:String,default:"if"},nativeScrollbar:{type:Boolean,default:!0},zIndex:Number,onMaskClick:Function,scrollbarProps:Object,contentStyle:[Object,String],trapFocus:{type:Boolean,default:!0},onEsc:Function,autoFocus:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!0},"onUpdate:show":[Function,Array],onUpdateShow:[Function,Array],onAfterEnter:Function,onAfterLeave:Function,drawerStyle:[String,Object],drawerClass:String,target:null,onShow:Function,onHide:Function});var On=E({name:"Drawer",inheritAttrs:!1,props:Dn,setup(e){const{mergedClsPrefixRef:n,namespaceRef:t,inlineThemeDisabled:s}=Ve(e),o=Mt(),i=G("Drawer","-drawer",Tn,Pt,e,n),l=D(()=>{const{placement:u}=e;if(u==="top"||u==="bottom")return"";const{width:$}=e;return Te($)}),a=D(()=>{const{placement:u}=e;if(u==="left"||u==="right")return"";const{height:$}=e;return Te($)}),r=D(()=>[{width:l.value,height:a.value},e.drawerStyle]);function f(u){const{onMaskClick:$,maskClosable:x}=e;x&&c(!1),$&&$(u)}function d(){var u;(u=e.onEsc)===null||u===void 0||u.call(e),e.closeOnEsc&&c(!1)}function c(u){const{onHide:$,onUpdateShow:x,"onUpdate:show":R}=e;x&&X(x,u),R&&X(R,u),$&&!u&&X($,u)}K(ge,{isMountedRef:o,mergedThemeRef:i,mergedClsPrefixRef:n,doUpdateShow:c});const p=D(()=>{const{common:{cubicBezierEaseInOut:u,cubicBezierEaseIn:$,cubicBezierEaseOut:x},self:{color:R,textColor:k,boxShadow:re,lineHeight:it,headerPadding:lt,footerPadding:ct,bodyPadding:ut,titleFontSize:dt,titleTextColor:ft,titleFontWeight:pt,headerBorderBottom:mt,footerBorderTop:ht,closeColor:_t,closeColorHover:vt,closeColorPressed:gt,closeSize:yt}}=i.value;return{"--n-line-height":it,"--n-color":R,"--n-text-color":k,"--n-box-shadow":re,"--n-bezier":u,"--n-bezier-out":x,"--n-bezier-in":$,"--n-header-padding":lt,"--n-body-padding":ut,"--n-footer-padding":ct,"--n-title-text-color":ft,"--n-title-font-size":dt,"--n-title-font-weight":pt,"--n-header-border-bottom":mt,"--n-footer-border-top":ht,"--n-close-color":_t,"--n-close-color-hover":vt,"--n-close-color-pressed":gt,"--n-close-size":yt}}),_=s?Ye("drawer",void 0,p,e):void 0;return{mergedClsPrefix:n,namespace:t,mergedBodyStyle:r,handleMaskClick:f,handleEsc:d,mergedTheme:i,cssVars:s?void 0:p,themeClass:_==null?void 0:_.themeClass,onRender:_==null?void 0:_.onRender,isMounted:o}},render(){const{mergedClsPrefix:e}=this;return S(It,{to:this.to,show:this.show},{default:()=>{var n;return(n=this.onRender)===null||n===void 0||n.call(this),me(S("div",{class:[`${e}-drawer-container`,this.namespace,this.themeClass],style:this.cssVars,role:"none"},this.showMask?S(Ue,{name:"fade-in-transition",appear:this.isMounted},{default:()=>this.show?S("div",{"aria-hidden":!0,class:[`${e}-drawer-mask`,this.showMask==="transparent"&&`${e}-drawer-mask--invisible`],onClick:this.handleMaskClick}):null}):null,S(vn,Object.assign({},this.$attrs,{class:[this.drawerClass,this.$attrs.class],style:[this.mergedBodyStyle,this.$attrs.style],blockScroll:this.blockScroll,contentStyle:this.contentStyle,placement:this.placement,scrollbarProps:this.scrollbarProps,show:this.show,displayDirective:this.displayDirective,nativeScrollbar:this.nativeScrollbar,onAfterEnter:this.onAfterEnter,onAfterLeave:this.onAfterLeave,trapFocus:this.trapFocus,autoFocus:this.autoFocus,showMask:this.showMask,onEsc:this.handleEsc,onClickoutside:this.handleMaskClick}),this.$slots)),[[zt,{zIndex:this.zIndex,enabled:this.show}]])}})}});const An={title:{type:String},headerStyle:[Object,String],footerStyle:[Object,String],bodyStyle:[Object,String],bodyContentStyle:[Object,String],nativeScrollbar:{type:Boolean,default:!0},scrollbarProps:Object,closable:Boolean};var Mn=E({name:"DrawerContent",props:An,setup(){const e=ce(ge,null);e||Rt("drawer-content","`n-drawer-content` must be placed inside `n-drawer`.");const{doUpdateShow:n}=e;function t(){n(!1)}return{handleCloseClick:t,mergedTheme:e.mergedThemeRef,mergedClsPrefix:e.mergedClsPrefixRef}},render(){const{title:e,mergedClsPrefix:n,nativeScrollbar:t,mergedTheme:s,bodyStyle:o,bodyContentStyle:i,headerStyle:l,footerStyle:a,scrollbarProps:r,closable:f,$slots:d}=this;return S("div",{role:"none",class:[`${n}-drawer-content`,t&&`${n}-drawer-content--native-scrollbar`]},d.header||e||f?S("div",{class:`${n}-drawer-header`,style:l,role:"none"},S("div",{class:`${n}-drawer-header__main`,role:"heading","aria-level":"1"},d.header!==void 0?d.header():e),f&&S(Lt,{onClick:this.handleCloseClick,clsPrefix:n,class:`${n}-drawer-header__close`})):null,t?S("div",{class:`${n}-drawer-body`,style:o,role:"none"},S("div",{class:`${n}-drawer-body-content-wrapper`,style:i,role:"none"},d)):S(ye,Object.assign({themeOverrides:s.peerOverrides.Scrollbar,theme:s.peers.Scrollbar},r,{class:`${n}-drawer-body`,contentClass:`${n}-drawer-body-content-wrapper`,contentStyle:i}),d),d.footer?S("div",{class:`${n}-drawer-footer`,style:a,role:"none"},d.footer()):null)}});function Pn(e){const{boxShadow2:n}=e;return{menuBoxShadow:n}}const zn=jt({name:"Popselect",common:Nt,peers:{Popover:Ut,InternalSelectMenu:Ht},self:Pn});var et=zn;const tt=Vt("n-popselect");var In=M("popselect-menu",`
 box-shadow: var(--n-menu-box-shadow);
`);const be={multiple:Boolean,value:{type:[String,Number,Array],default:null},cancelable:Boolean,options:{type:Array,default:()=>[]},size:{type:String,default:"medium"},scrollable:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onMouseenter:Function,onMouseleave:Function,renderLabel:Function,onChange:[Function,Array]},Me=Wt(be);var Rn=E({name:"PopselectPanel",props:be,setup(e){const n=ce(tt),{mergedClsPrefixRef:t,inlineThemeDisabled:s}=Ve(e),o=G("Popselect","-pop-select",In,et,n.props,t),i=D(()=>Yt(e.options,Kt));function l(p,_){const{onUpdateValue:u,"onUpdate:value":$,onChange:x}=e;u&&X(u,p,_),$&&X($,p,_),x&&X(x,p,_)}function a(p){f(p.key)}function r(p){Jt(p,"action")||p.preventDefault()}function f(p){const{value:{getNode:_}}=i;if(e.multiple)if(Array.isArray(e.value)){const u=[],$=[];let x=!0;e.value.forEach(R=>{if(R===p){x=!1;return}const k=_(R);k&&(u.push(k.key),$.push(k.rawNode))}),x&&(u.push(p),$.push(_(p).rawNode)),l(u,$)}else{const u=_(p);u&&l([p],[u.rawNode])}else if(e.value===p&&e.cancelable)l(null,null);else{const u=_(p);u&&l(p,u.rawNode),n.setShow(!1)}he(()=>{n.syncPosition()})}q(Xt(e,"options"),()=>{he(()=>{n.syncPosition()})});const d=D(()=>{const{self:{menuBoxShadow:p}}=o.value;return{"--n-menu-box-shadow":p}}),c=s?Ye("select",void 0,d,n.props):void 0;return{mergedTheme:n.mergedThemeRef,mergedClsPrefix:t,treeMate:i,handleToggle:a,handleMenuMousedown:r,cssVars:s?void 0:d,themeClass:c==null?void 0:c.themeClass,onRender:c==null?void 0:c.onRender}},render(){var e;return(e=this.onRender)===null||e===void 0||e.call(this),S(qt,{clsPrefix:this.mergedClsPrefix,focusable:!0,class:[`${this.mergedClsPrefix}-popselect-menu`,this.themeClass],style:this.cssVars,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,multiple:this.multiple,treeMate:this.treeMate,size:this.size,value:this.value,virtualScroll:!1,scrollable:this.scrollable,renderLabel:this.renderLabel,onToggle:this.handleToggle,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseenter,onMousedown:this.handleMenuMousedown},{action:()=>{var n,t;return((t=(n=this.$slots).action)===null||t===void 0?void 0:t.call(n))||[]},empty:()=>{var n,t;return((t=(n=this.$slots).empty)===null||t===void 0?void 0:t.call(n))||[]}})}});const Ln=Object.assign(Object.assign(Object.assign(Object.assign({},G.props),Ke(De,["showArrow","arrow"])),{placement:Object.assign(Object.assign({},De.placement),{default:"bottom"}),trigger:{type:String,default:"hover"}}),be);var jn=E({name:"Popselect",props:Ln,__popover__:!0,setup(e){const n=G("Popselect","-popselect",void 0,et,e),t=T(null);function s(){var l;(l=t.value)===null||l===void 0||l.syncPosition()}function o(l){var a;(a=t.value)===null||a===void 0||a.setShow(l)}return K(tt,{props:e,mergedThemeRef:n,syncPosition:s,setShow:o}),Object.assign(Object.assign({},{syncPosition:s,setShow:o}),{popoverInstRef:t,mergedTheme:n})},render(){const{mergedTheme:e}=this,n={theme:e.peers.Popover,themeOverrides:e.peerOverrides.Popover,builtinThemeOverrides:{padding:"0"},ref:"popoverInstRef",internalRenderBody:(t,s,o,i,l)=>S(Rn,Object.assign({},He(this.$attrs,{class:t,style:o}),Zt(this.$props,Me),{ref:fn(s),onMouseenter:i,onMouseleave:l}),{action:()=>{var a,r;return(r=(a=this.$slots).action)===null||r===void 0?void 0:r.call(a)},empty:()=>{var a,r;return(r=(a=this.$slots).empty)===null||r===void 0?void 0:r.call(a)}})};return S(Xe,Object.assign({},Ke(this.$props,Me),n),{trigger:()=>{var t,s;return(s=(t=this.$slots).default)===null||s===void 0?void 0:s.call(t)}})}});const Nn=Object.assign(Object.assign({},G.props),{xScrollable:Boolean,onScroll:Function}),Un=E({name:"Scrollbar",props:Nn,setup(){const e=T(null);return Object.assign(Object.assign({},{scrollTo:(...t)=>{var s;(s=e.value)===null||s===void 0||s.scrollTo(t[0],t[1])},scrollBy:(...t)=>{var s;(s=e.value)===null||s===void 0||s.scrollBy(t[0],t[1])}}),{scrollbarInstRef:e})},render(){return S(ye,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}});var Hn=Un;const Vn=Q({groupThreshold:3e3}),Yn=Vn;function we(e,n){const t={};return n.forEach(s=>{t[s]=e[s]}),t}function Kn(e){return new Function(`return /${e}/`)()}const nt="FFXIV__",$e=window.localStorage;function Se(e){return`${nt}${e}`}function st(e){return e.replace(nt,"")}function Xn(e){const n=$e.getItem(Se(e));try{return typeof n!="undefined"?JSON.parse(n):void 0}catch(t){}}function qn(e,n){$e.setItem(Se(e),JSON.stringify(n))}function Pe(e){$e.removeItem(Se(e))}function Wn(e){var n;const t=v(e);return(n=t==null?void 0:t.$el)!=null?n:t}const Jn=en?window:void 0;function ze(...e){let n,t,s,o;if(Gt(e[0])?([t,s,o]=e,n=Jn):[n,t,s,o]=e,!n)return fe;let i=fe;const l=q(()=>Wn(n),r=>{i(),r&&(r.addEventListener(t,s,o),i=()=>{r.removeEventListener(t,s,o),i=fe})},{immediate:!0,flush:"post"}),a=()=>{l(),i()};return Qt(a),a}const _e=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ve="__vueuse_ssr_handlers__";_e[ve]=_e[ve]||{};_e[ve];function Zn(e){const n=T(!1);return ze(e,"mouseenter",()=>n.value=!0),ze(e,"mouseleave",()=>n.value=!1),n}const Gn=/^40/,Qn="E0000000";function es(e){return e[0]==="21"?"single":e[0]==="22"?"aoe":"unknown"}function ts(e){return e[6]===Qn}function ot(e){switch(e[0]){case"21":case"22":return{_abilityType:es(e),_miss:ts(e),timestamp:e[1],sourceId:e[2],source:e[3],abilityId:e[4],ability:e[5],targetId:e[6],target:e[7]}}}let ns=0;function ss(e,n){const t=Array.isArray(e)?ot(e):e,s=V(t.timestamp).valueOf(),o=s-n.startTimestamp;return{_type:"log",_id:`L${ns++}`,_timestamp:s,_cd:0,_lastUse:0,_targets:[{id:t.targetId,name:t.target}],_abilityType:t._abilityType,_miss:t._miss,phase:0,isHostile:Gn.test(t.sourceId),timestamp:o,source:t.source,ability:t.ability}}let os=0;function Ce(e){return e._type==="reference"?e:N({_type:"reference",_id:os++},we(e,["phase","isHostile","timestamp","ability","source"]))}function rs(e){return we(e,["phase","isHostile","timestamp","ability","source"])}let pe=0;const H=Q({list:cs(),get(e){const n=e?H.list.find(i=>i.id===e):null;if(!n)return le();const t=n._key,s=Xn(t);function o(i,l){var a,r,f;return Y(N({},i),{id:l.id,title:l.title,phases:((a=i.phases)!=null?a:[]).map(d=>Y(N({},d),{_id:pn(),_regexp:Kn(d.regexp)})),list:((r=i.list)!=null?r:[]).map(d=>d.map(c=>Ce(c))),abilities:((f=i.abilities)!=null?f:[]).map(d=>Y(N({},d),{_id:mn()}))})}return s?o(s,n):le()},set(e){let n=H.list.find(t=>t.id===e.id);return n?(Pe(n._key),n.title=e.title,n.updatedAt=Date.now()):(n={id:as(),_key:"",title:e.title,createdAt:Date.now(),updatedAt:Date.now()},H.list.push(n)),n._key=is(n),qn(n._key,{phases:e.phases.map(t=>({name:t.name,regexp:t.regexp})),list:e.list.map(t=>t.map(s=>rs(s))),abilities:e.abilities.map(t=>({name:t.name,cd:t.cd}))}),n.id},remove(e){const n=H.list.findIndex(t=>t.id===e);if(~n){const[t]=H.list.splice(n,1);Pe(t._key)}}}),Z=de(H);function as(){for(;;)if(pe+=1,!H.list.find(e=>e.id===pe))return pe}function is(e){const n=we(e,["id","title","updatedAt","createdAt"]);return JSON.stringify(n)}function ls(e){const n=st(e);try{return typeof n!="undefined"?JSON.parse(n):void 0}catch(t){}}function cs(){const e=[];return Object.keys(localStorage).forEach(n=>{const t=ls(n);t&&"id"in t&&(t._key=st(n),e.push(t))}),e}const ee=T(le()),ae=D(()=>ee.value.list),te=Q({current:ee,save(e){return Z.set(e)},restore(e){ee.value=Z.get(e)},add(e){var s;const n=(s=ae.value[e.phase])!=null?s:ae.value[e.phase]=[];let t=0;for(;t<n.length;t+=1){const o=n[t];if(!(e.timestamp<=o.timestamp))break}n.splice(t,0,Ce(e)),te.save(ee.value)},remove(e){for(let n=0;n<ae.value.length;n+=1){const t=ae.value[n];for(let s=0;s<t.length;s+=1)if(t[s]._id===e._id){t.splice(s,1),te.save(ee.value);return}}throw new Error(`\u627E\u4E0D\u5230\u8BB0\u5F55, [${e._id}]: ${e.ability}(${e.source})`)},update(e){e._id&&te.remove(e),te.add(e)}}),C=de(te),Ie=D(()=>{const e=new Map;return C.current.abilities.forEach(n=>{e.set(n.name,n)}),e}),us=Q({map:Ie,get(e){return Ie.value.get(e)}}),Re=us,L=Q({list:[],lastUpdate:0,add(e,n){var o;const{list:t}=L;((o=t[n])!=null?o:t[n]=[]).push(e)},clear(){L.list=[]},getLast(){const{list:e}=L;for(let n=e.length-1;n>=0;n-=1){const t=e[n];if(t.length)return t[t.length-1]}},getLastAbility(e){const{list:n}=L;for(let t=n.length-1;t>=0;t-=1){const s=n[t];for(let o=s.length-1;o>=0;o-=1){const i=s[o];if(i.ability===e.ability&&i.source===e.source)return i}}},addLogLine(e,{phase:n,startTimestamp:t}){var r,f;const{line:s}=e,o=ot(s);if(!o)return;let i;if(Re.map.size){if(i=Re.get(o.ability),!i)return}else i={_id:0,name:o.ability};const l=ss(o,{startTimestamp:t});l._cd=(r=i.cd)!=null?r:0,l.phase=n;const a=L.getLastAbility(l);if(l._lastUse=(f=a==null?void 0:a._timestamp)!=null?f:0,l._abilityType==="aoe"){const d=L.getLast();if(d&&d.ability===l.ability&&d.source===l.source&&d._timestamp===l._timestamp){d._targets.push(...l._targets);return}}L.add(l,n),L.lastUpdate=Date.now()}}),j=de(L),P=Q({isActive:!1,duration:"",zoneName:"",phase:0,setPhase(e){P.phase=e},phaseStartTime:Date.now(),setPhaseStartTime(e){P.phaseStartTime=e}}),F=de(P);function ds(){let e;function n(t){const s=t.Encounter;P.isActive=t.isActive==="true"||t.isActive===!0,s?s.CurrentZoneName||P.duration?(P.zoneName=s.CurrentZoneName,P.duration=s.duration,e=s):e&&(P.zoneName=e.CurrentZoneName,P.duration=e.duration):(P.zoneName="",P.duration="")}return qe(()=>{window.addOverlayListener("CombatData",n)}),We(()=>{window.removeOverlayListener("CombatData",n)}),P}const fs=I("\u53D6\u6D88"),ke=E({props:{show:{type:Boolean}},emits:["update:show"],setup(e,{emit:n}){return(t,s)=>{const o=nn,i=se,l=oe,a=sn,r=Je;return m(),O(r,{show:e.show,preset:"card",closable:!1},{default:h(()=>[g(a,{title:"\u7B49\u5F85\u4E0B\u4E00\u6B65...",description:"\u8BF7\u5728\u5B50\u7A97\u53E3\u5B8C\u6210\u4E0B\u4E00\u6B65\u64CD\u4F5C"},{icon:h(()=>[g(o)]),default:h(()=>[g(l,{justify:"center"},{default:h(()=>[g(i,{type:"primary",onClick:s[0]||(s[0]=f=>n("update:show",!1))},{default:h(()=>[fs]),_:1})]),_:1})]),_:1}),tn(t.$slots,"default")]),_:3},8,["show"])}}}),rt=Symbol(),ne=e=>e._type==="log",Le=e=>e._type==="reference",ps={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},ms=b("path",{d:"M488 488V192a16 16 0 0 1 16-16h16a16 16 0 0 1 16 16v296H832a16 16 0 0 1 16 16v16a16 16 0 0 1-16 16H536V832a16 16 0 0 1-16 16h-16a16 16 0 0 1-16-16V536H192a16 16 0 0 1-16-16v-16a16 16 0 0 1 16-16h296z"},null,-1),hs=[ms];function je(e,n){return m(),w("svg",ps,hs)}const _s=["data-log"],vs={key:0,class:"timeline__row-miss"},gs={key:1,class:"timeline__row-count"},ys={key:1,class:"timeline__row-offset"},bs={key:2,class:"timeline__row-source"},Ne=E({props:{data:null},setup(e){const n=e,t=T(),s=Zn(t),o=D(()=>{if(!ne(n.data))return;const{_timestamp:l,_lastUse:a,_cd:r}=n.data;if(!l||!a||!r)return"";const f=Math.round((l-a-r)/1e3);return f>0?`+${f}s`:f<0?`${f}s`:""}),i=ce(rt);return(l,a)=>{const r=hn,f=se;return m(),w("div",{class:"timeline__row",ref_key:"rowRef",ref:t,"data-log":v(ne)(e.data)?e.data._id:void 0,onClick:a[2]||(a[2]=d=>{var c;return(c=v(i))==null?void 0:c.openDetail(e.data)})},[b("span",{class:Ze(["timeline__row-name",{hostile:e.data.isHostile}])},B(e.data.ability),3),v(ne)(e.data)&&e.data._abilityType==="aoe"?(m(),w(z,{key:0},[e.data._miss?(m(),w("span",vs,"[miss]")):(m(),w("span",gs,"["+B(e.data._targets.length)+"]",1))],64)):A("",!0),v(o)?(m(),w("span",ys,B(v(o)),1)):A("",!0),e.data.source?(m(),w("span",bs,"("+B(e.data.source)+")",1)):A("",!0),v(s)?(m(),w(z,{key:3},[v(ne)(e.data)?(m(),O(f,{key:0,class:"timeline__row-fast",type:"primary",circle:"",title:"\u52A0\u5165\u5230\u53C2\u8003\u65F6\u95F4\u8F74",onClick:a[0]||(a[0]=Oe(d=>v(C).add(e.data),["stop"]))},{default:h(()=>[g(r,{size:"1em"},{default:h(()=>[g(v(je))]),_:1})]),_:1})):A("",!0),v(Le)(e.data)?(m(),O(f,{key:1,class:"timeline__row-fast",type:"error",circle:"",title:"\u79FB\u9664",onClick:a[1]||(a[1]=Oe(d=>v(Le)(e.data)&&v(C).remove(e.data),["stop"]))},{default:h(()=>[g(r,{size:"1em",class:"timeline__row-fast__remove"},{default:h(()=>[g(v(je))]),_:1})]),_:1})):A("",!0)],64)):A("",!0)],8,_s)}}}),ws={class:"timeline__time"},$s={class:"timeline__time-row"},Ss={key:0,class:"timeline__time-row end-time"},Cs={class:"timeline__container"},ks={class:"timeline__col"},Fs={class:"timeline__col"},xs=E({props:{reference:null,logs:null},setup(e){const n=e,t=D(()=>{const s=[n.reference,n.logs].reduce((r,f)=>r.concat(f),[]).sort((r,f)=>r.timestamp-f.timestamp),o=[];function i(r){return{timestamp:r.timestamp,endTimestamp:r.timestamp,reference:[],log:[]}}let l=null,a;for(;s.length;){const r=s.shift();!r||(l||(l=r),r.timestamp<l.timestamp+Yn.groupThreshold?l=r:(l=r,a=i(r),o.push(a)),a||(a=i(r),o.push(a)),a[r._type].push(r),a.endTimestamp=r.timestamp)}return o});return(s,o)=>(m(!0),w(z,null,W(v(t),(i,l)=>(m(),w("div",{key:i.phase,class:"timeline__phase"},[b("div",ws,[b("div",$s,B(v(V).duration(i.timestamp).format("mm:ss")),1),i.reference.length>1||i.log.length>1?(m(),w("div",Ss,B(v(V).duration(i.endTimestamp).format("mm:ss")),1)):A("",!0)]),b("div",Cs,[b("div",ks,[(m(!0),w(z,null,W(i.reference,a=>(m(),O(Ne,{key:a._id,data:a},null,8,["data"]))),128))]),b("div",Fs,[(m(!0),w(z,null,W(i.log,a=>(m(),O(Ne,{key:a._id,data:a},null,8,["data"]))),128))])])]))),128))}}),Bs=E({props:{detail:null},setup(e){return(n,t)=>{const s=on,o=rn,i=oe,l=an;return m(),O(l,{ref:"formRef","label-width":80},{default:h(()=>[g(s,{label:"\u57FA\u672C\u4FE1\u606F"},{default:h(()=>[I(" ["+B(v(V).duration(e.detail.timestamp).format("mm:ss.SSS"))+"] "+B(e.detail.ability)+" ("+B(e.detail.source)+") ",1)]),_:1}),v(ne)(e.detail)&&e.detail._abilityType==="aoe"&&!e.detail._miss?(m(),O(s,{key:0,label:"\u8303\u56F4"},{default:h(()=>[g(i,null,{default:h(()=>[(m(!0),w(z,null,W(e.detail._targets,({id:a,name:r})=>(m(),O(o,{key:a},{default:h(()=>[I(B(r),1)]),_:2},1024))),128))]),_:1})]),_:1})):A("",!0)]),_:1},512)}}}),Es=E({props:{detail:null},emits:["success","cancel"],setup(e,{emit:n}){const t=e;return Ge("./reference-row.html",{width:400,height:500}),J("reference-row@loaded",(s,{source:o})=>{ie(o,"reference-row@loaded:replay",{phases:Ae(C.current.phases),form:Ae(t.detail)})}),J("reference-row@save",(s,o)=>{ie(o.source,"reference-row@save:replay",{}),C.update(s),window.$message.success("\u7F16\u8F91\u6210\u529F"),n("success")}),J("@close",()=>{n("cancel")}),(s,o)=>null}});const Ts={class:"timeline"},Ds=b("div",{class:"timeline__header timeline__header--title"},[b("div",{class:"timeline__time"},[b("div",{class:"timeline__time-row"},"\u65F6\u95F4")]),b("div",{class:"timeline__container"},[b("div",{class:"timeline__col"},[b("div",{class:"timeline__row"},[b("span",{class:"timeline__row-name"},"\u53C2\u8003\u65F6\u95F4\u8F74")])]),b("div",{class:"timeline__col"},[b("div",{class:"timeline__row"},[b("span",{class:"timeline__row-name"},"\u5F53\u524D\u6218\u6597")])])])],-1),Os={key:0,class:"timeline__phase-title"},As=I("\u5173\u95ED"),Ms=I("\u7F16\u8F91"),Ps=E({setup(e){const n=D(()=>Math.max(C.current.list.length,j.list.length,F.phase+1)),t=T();q(()=>j.lastUpdate,()=>Be(this,null,function*(){var c,p,_,u;const a=j.getLast();if(!a)return;yield he();const r=document.querySelector(`[data-log="${a._id}"]`),f=(u=(_=(p=(c=t.value)==null?void 0:c.$refs)==null?void 0:p.scrollbarInstRef)==null?void 0:_.$refs)==null?void 0:u.containerRef;if(!r||!f)return;const d=r.offsetTop-f.offsetTop+r.offsetHeight-f.offsetHeight*.7;t.value.scrollTo({top:d,behavior:"smooth"})}));const s=T(!1),o=T();K(rt,{openDetail(a){s.value=!0,o.value=a}});const i=T(!1);function l(){s.value=!1,i.value=!0}return(a,r)=>{const f=se,d=oe,c=Je,p=Hn;return m(),O(p,{ref_key:"el",ref:t},{default:h(()=>[b("div",Ts,[Ds,(m(!0),w(z,null,W(v(n),(_,u)=>{var $,x;return m(),w(z,null,[u>0||(($=v(C).current.phases[u])==null?void 0:$.name)?(m(),w("div",Os,B(((x=v(C).current.phases[u])==null?void 0:x.name)||`P${u+1}`),1)):A("",!0),g(xs,{reference:v(C).current.list[u],logs:v(j).list[u]},null,8,["reference","logs"])],64)}),256))]),g(c,{show:s.value,"onUpdate:show":r[1]||(r[1]=_=>s.value=_),style:{width:"600px"},preset:"card",title:"\u8BE6\u60C5",closable:"","auto-focus":!1},{footer:h(()=>[g(d,{justify:"end"},{default:h(()=>{var _;return[g(f,{onClick:r[0]||(r[0]=u=>s.value=!1)},{default:h(()=>[As]),_:1}),((_=o.value)==null?void 0:_._type)==="reference"?(m(),O(f,{key:0,type:"primary",onClick:l},{default:h(()=>[Ms]),_:1})):A("",!0)]}),_:1})]),default:h(()=>[o.value?(m(),O(Bs,{key:0,detail:o.value},null,8,["detail"])):A("",!0)]),_:1},8,["show"]),g(ke,{show:i.value,"onUpdate:show":r[4]||(r[4]=_=>i.value=_)},{default:h(()=>[o.value?(m(),O(Es,{key:0,detail:o.value,onSuccess:r[2]||(r[2]=_=>i.value=!1),onCancel:r[3]||(r[3]=_=>i.value=!1)},null,8,["detail"])):A("",!0)]),_:1},8,["show"])]),_:1},512)}}}),at=E({props:{detail:null},emits:["success","cancel"],setup(e,{emit:n}){const t=e;return Ge("./reference.html",{width:600,height:600}),J("reference@loaded",(s,{source:o})=>{ie(o,"reference@loaded:replay",{form:_n.exports.cloneDeep(t.detail)})}),J("reference@save",(s,o)=>{ie(o.source,"reference@save:replay",{});const i=Z.set(s);window.$message.success("\u4FDD\u5B58\u6210\u529F"),n("success",i,s)}),J("@close",()=>{n("cancel")}),(s,o)=>null}});const zs=["onClick"],Is=I("\u7F16\u8F91"),Rs=I("\u5220\u9664"),Ls=I("\u65B0\u5EFA"),js=E({props:{show:{type:Boolean}},emits:["update:show"],setup(e,{emit:n}){const t=D(()=>Z.list.slice().sort((c,p)=>p.createdAt-c.createdAt));function s(c){C.restore(c.id),n("update:show",!1),window.$message.success(`\u5DF2\u5207\u6362\u81F3 ${c.title}`)}const o=T(!1),i=T();function l(c){if(c){const p=Z.get(c.id);if(p)i.value=p;else{window.$message.error(`\u6CA1\u6709\u627E\u5230 [${c.id}]${c.title}`);return}}else i.value=le();o.value=!0}function a(c){o.value=!1,c===C.current.id&&C.restore(c)}function r(c){window.$dialog.warning({title:"\u8B66\u544A",content:`\u786E\u5B9A\u8981\u5220\u9664<${c.title}>\u5417\uFF1F`,positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{var p;Z.remove(c.id),window.$message.success("\u5220\u9664\u6210\u529F"),C.current.id===c.id&&C.restore((p=t.value[0])==null?void 0:p.id)}})}const f=ln(),d=D(()=>{const c=f.value;return{"--a-primary-color":c.primaryColor,"--a-success-color":c.successColor,"--a-error-color":c.errorColor,"--a-warning-color":c.warningColor,"--a-info-color":c.infoColor,"--n-header-padding":"14px 10px","--n-body-padding":"10px 10px","--n-footer-padding":"10px 10px"}});return(c,p)=>{const _=se,u=oe,$=Xe,x=Mn,R=On;return m(),w(z,null,[g(R,{show:e.show,"onUpdate:show":p[1]||(p[1]=k=>n("update:show",k)),placement:"right",class:"reference-list__drawer","auto-focus":!1,style:cn(v(d))},{default:h(()=>[g(x,{closable:"",title:"\u53C2\u8003\u65F6\u95F4\u8F74"},{footer:h(()=>[g(_,{type:"primary",onClick:p[0]||(p[0]=k=>l())},{default:h(()=>[Ls]),_:1})]),default:h(()=>[(m(!0),w(z,null,W(v(t),k=>(m(),O($,{scrollable:"",placement:"bottom-end"},{trigger:h(()=>[b("div",{class:Ze(["reference-list__drawer-item",{active:k.id===v(C).current.id}]),onClick:re=>s(k)},[b("div",null,"["+B(k.id)+"]"+B(k.title),1),b("div",null," \u521B\u5EFA\u65F6\u95F4 "+B(v(V)(k.createdAt).format("YYYY-MM-DD HH:mm")),1),b("div",null," \u6700\u540E\u66F4\u65B0 "+B(v(V)(k.updatedAt).format("YYYY-MM-DD HH:mm")),1)],10,zs)]),default:h(()=>[g(u,null,{default:h(()=>[g(_,{type:"primary",secondary:"",onClick:re=>l(k)},{default:h(()=>[Is]),_:2},1032,["onClick"]),g(_,{type:"error",secondary:"",onClick:re=>r(k)},{default:h(()=>[Rs]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1},8,["show","style"]),g(ke,{show:o.value,"onUpdate:show":p[3]||(p[3]=k=>o.value=k)},{default:h(()=>[i.value?(m(),O(at,{key:0,detail:i.value,onSuccess:a,onCancel:p[2]||(p[2]=k=>o.value=!1)},null,8,["detail"])):A("",!0)]),_:1},8,["show"])],64)}}});const Ns={class:"the-header"},Us={class:"the-header__title"},Hs={key:0,class:"duration"},Vs={key:1,class:"title"},Ys={key:2},Ks={class:"the-header__toolbar"},Xs=I(" \u65F6\u95F4\u8F74 "),qs=I(" \u4FDD\u5B58 "),Ws=E({setup(e){function n(){window.$dialog.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u8981\u8986\u76D6\u5417\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{const f=C.save(Y(N({},C.current),{list:j.list}));C.restore(f),window.$message.success("\u4FDD\u5B58\u6210\u529F")}})}const t=T(!1),s=T();function o(f){t.value=!1,C.restore(f)}const i=[{label:"\u8986\u76D6\u4FDD\u5B58",value:"\u8986\u76D6\u4FDD\u5B58",onClick:n},{label:"\u53E6\u5B58\u4E3A",value:"\u53E6\u5B58\u4E3A",onClick:()=>{t.value=!0,s.value=Y(N({},C.current),{id:0,list:j.list.map(f=>f.map(d=>Ce(d)))})}}];function l(f,d){var c;(c=d.onClick)==null||c.call(d)}const a=T(!1),r=()=>null;return(f,d)=>{const c=se,p=jn,_=oe;return m(),w(z,null,[b("div",Ns,[b("div",Us,[v(F).duration?(m(),w("span",Hs,B(v(F).duration),1)):A("",!0),v(C).current.title?(m(),w("span",Vs,B(v(C).current.title),1)):(m(),w("span",Ys,"\u672A\u9009\u62E9\u65F6\u95F4\u8F74"))]),b("div",Ks,[g(_,null,{default:h(()=>[g(c,{type:"primary",round:"",size:"tiny",title:"\u9009\u62E9\u53C2\u8003\u65F6\u95F4\u8F74",onClick:d[0]||(d[0]=u=>a.value=!0)},{default:h(()=>[Xs]),_:1}),g(p,{options:i,"onUpdate:value":l},{default:h(()=>[g(c,{type:"primary",round:"",size:"tiny",title:"\u4FDD\u5B58\u5F53\u524D\u6218\u6597"},{default:h(()=>[qs]),_:1})]),_:1}),g(v(r))]),_:1})])]),g(js,{show:a.value,"onUpdate:show":d[1]||(d[1]=u=>a.value=u)},null,8,["show"]),g(ke,{show:t.value,"onUpdate:show":d[3]||(d[3]=u=>t.value=u)},{default:h(()=>[s.value?(m(),O(at,{key:0,detail:s.value,onSuccess:o,onCancel:d[2]||(d[2]=u=>t.value=!1)},null,8,["detail"])):A("",!0)]),_:1},8,["show"])],64)}}});var Js=Qe(Ws,[["__scopeId","data-v-e36914f0"]]);const Zs={class:"the-body"},Gs=E({setup(e){ds(),q(()=>[F.isActive],()=>{!F.isActive||j.clear()},{immediate:!0}),q(()=>F.isActive,t=>{if(t){F.setPhase(0);let s=0;if(F.duration){const[o,i]=F.duration.split(":");s=V.duration(0).add({minutes:+o,seconds:+i}).asMilliseconds()}F.setPhaseStartTime(Date.now()-s)}}),q(()=>F.zoneName,t=>{});function n(t){var o;if(!F.isActive)return;const s=C.current.phases[F.phase+1];(o=s==null?void 0:s._regexp)!=null&&o.test(t.rawLine)&&(F.setPhase(F.phase+1),F.setPhaseStartTime(Date.now())),j.addLogLine(t,{startTimestamp:F.phaseStartTime,phase:F.phase})}return qe(()=>{window.addOverlayListener("LogLine",n),window.startOverlayEvents()}),We(()=>{window.removeOverlayListener("LogLine",n)}),(t,s)=>(m(),w("div",Zs,[g(Js),g(Ps,{class:"the-timeline"})]))}});var Qs=Qe(Gs,[["__scopeId","data-v-3c39aef1"]]);const eo=E({setup(e){return(n,t)=>(m(),O(un,null,{default:h(()=>[g(Qs)]),_:1}))}});dn(eo).mount("#app");
